# ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ê°œìš”

> ðŸ“‹ **ë¬¸ì„œ ëª©ì **: Mermaid Saiko ì‹œìŠ¤í…œì˜ ì „ì²´ ì•„í‚¤í…ì²˜ ê°œìš”

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2025-10-26

---

## ì‹œìŠ¤í…œ ê°œìš”

Mermaid SaikoëŠ” **ë‹¨ì¼ ë°±ì—”ë“œ ì„œë²„ + ì›¹ í”„ë¡ íŠ¸ì—”ë“œ**ë¡œ êµ¬ì„±ëœ ëª¨ë†€ë¦¬ì‹ ì•„í‚¤í…ì²˜ìž…ë‹ˆë‹¤.

### ì•„í‚¤í…ì²˜ ìœ í˜•
- **ëª¨ë†€ë¦¬ì‹ ì•„í‚¤í…ì²˜** (Monolithic)
- **DDD ê¸°ë°˜ ë ˆì´ì–´ë“œ ì•„í‚¤í…ì²˜** (Layered Architecture)

### ì´ìœ 
- í”„ë¡œì íŠ¸ ë²”ìœ„ê°€ ëª…í™•í•˜ê³  ì œí•œì 
- ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë¡œ ë¶„ë¦¬í•  í•„ìš” ì—†ìŒ
- ê°œë°œ ì†ë„ ë° ë°°í¬ ë‹¨ìˆœí™” ìš°ì„ 
- í–¥í›„ í™•ìž¥ í•„ìš” ì‹œ Context ë‹¨ìœ„ë¡œ ë¶„ë¦¬ ê°€ëŠ¥

---

## ì „ì²´ ì‹œìŠ¤í…œ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                 â”‚
â”‚               ì›¹ ë¸Œë¼ìš°ì € (User)                â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ HTTP (REST API)
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                 â”‚
â”‚          Mermaid Saiko ì„œë²„ (NestJS)           â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚         API Layer (Controllers)          â”‚ â”‚
â”‚  â”‚  /api/v1/rendering/*    /api/v1/export/* â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚               â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚      Application Layer (Use Cases)       â”‚ â”‚
â”‚  â”‚   RenderDiagram  ExportImage  etc...     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚               â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚        Domain Layer (Aggregates)         â”‚ â”‚
â”‚  â”‚   Diagram    DiagramImage  EditorSession â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚               â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚    Infrastructure Layer (Repositories)   â”‚ â”‚
â”‚  â”‚   Mermaid.js  Puppeteer/Canvas  etc...   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ (Optional - í–¥í›„ í™•ìž¥)
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                 â”‚
â”‚          ë°ì´í„°ë² ì´ìŠ¤ (PostgreSQL)              â”‚
â”‚         (í˜„ìž¬ ë‹¨ê³„ì—ì„œëŠ” ì„ íƒì )                â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ë ˆì´ì–´ êµ¬ì¡° (DDD Layered Architecture)

### 1. API Layer (Presentation)
**ì±…ìž„**: HTTP ìš”ì²­/ì‘ë‹µ ì²˜ë¦¬, DTO ë³€í™˜

**êµ¬ì„± ìš”ì†Œ**:
- `RenderingController`: `/api/v1/rendering/*` ì—”ë“œí¬ì¸íŠ¸
- `ExportController`: `/api/v1/export/*` ì—”ë“œí¬ì¸íŠ¸
- Request/Response DTO
- Validation Pipe
- Exception Filter

**ê¸°ìˆ **: NestJS Controllers, Class-validator

---

### 2. Application Layer (Use Cases)
**ì±…ìž„**: ë¹„ì¦ˆë‹ˆìŠ¤ í”Œë¡œìš° ì¡°ìœ¨, íŠ¸ëžœìž­ì…˜ ê´€ë¦¬

**êµ¬ì„± ìš”ì†Œ**:
- `RenderDiagramUseCase`: ë‹¤ì´ì–´ê·¸ëž¨ ë Œë”ë§ í”Œë¡œìš°
- `ExportImageUseCase`: ì´ë¯¸ì§€ export í”Œë¡œìš°
- `ValidateMermaidCodeUseCase`: ì½”ë“œ ê²€ì¦ í”Œë¡œìš°
- Domain Event Publisher/Handler

**íŠ¹ì§•**: Domain Layerë¥¼ í˜¸ì¶œí•˜ì—¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‹¤í–‰

---

### 3. Domain Layer (Core Business Logic)
**ì±…ìž„**: ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™, ë¶ˆë³€ì‹ ìœ ì§€

**êµ¬ì„± ìš”ì†Œ**:
- **Aggregates**: Diagram, DiagramImage, EditorSession
- **Value Objects**: MermaidCode, ExportOptions, RenderingError
- **Domain Events**: DiagramRendered, ImageExported, etc.
- **Domain Services**: (í•„ìš” ì‹œ)

**íŠ¹ì§•**:
- í”„ë ˆìž„ì›Œí¬ ë…ë¦½ì  (ìˆœìˆ˜ TypeScript)
- Infrastructure Layerì— ì˜ì¡´í•˜ì§€ ì•ŠìŒ

---

### 4. Infrastructure Layer (Technical)
**ì±…ìž„**: ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬, DB ì—°ë™, íŒŒì¼ ì‹œìŠ¤í…œ

**êµ¬ì„± ìš”ì†Œ**:
- `DiagramRepository`: Diagram ì €ìž¥/ì¡°íšŒ (í˜„ìž¬ëŠ” ì¸ë©”ëª¨ë¦¬)
- `MermaidRenderer`: Mermaid.jsë¥¼ ì‚¬ìš©í•œ ë Œë”ë§
- `ImageExporter`: Puppeteer/Canvasë¥¼ ì‚¬ìš©í•œ ì´ë¯¸ì§€ ë³€í™˜
- Event Bus êµ¬í˜„ (ê°„ë‹¨í•œ in-process event emitter)

**ê¸°ìˆ **: Mermaid.js, Puppeteer (ë˜ëŠ” Canvas), TypeORM (í–¥í›„)

---

## ë°ì´í„° íë¦„

### ì˜ˆì‹œ: Mermaid ì½”ë“œ ë Œë”ë§ ìš”ì²­

```
1. [Client] â†’ POST /api/v1/rendering/render { mermaidCode: "..." }

2. [API Layer] RenderingController
   â†“ Request DTO ë³€í™˜ ë° Validation

3. [Application Layer] RenderDiagramUseCase
   â†“ Diagram Aggregate ìƒì„± ìš”ì²­

4. [Domain Layer] Diagram.create(mermaidCode)
   â†“ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ê²€ì¦
   â†“ render() ë©”ì„œë“œ í˜¸ì¶œ

5. [Infrastructure Layer] MermaidRenderer.render(svg)
   â†“ Mermaid.js ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©
   â†“ SVG ë¬¸ìžì—´ ë°˜í™˜

6. [Domain Layer] Diagram.renderedSvg ì €ìž¥
   â†“ DiagramRendered ì´ë²¤íŠ¸ ë°œí–‰

7. [Application Layer] Repositoryì— ì €ìž¥ (optional)
   â†“ Response DTO ë³€í™˜

8. [API Layer] JSON ì‘ë‹µ ë°˜í™˜

9. [Client] â† { success: true, data: { ... } }
```

---

## ë°°í¬ êµ¬ì¡°

### ê°œë°œ í™˜ê²½
```
Docker Compose
â”œâ”€ backend (NestJS)
â”‚  â””â”€ Port 3000
â”œâ”€ frontend (React/Vue)
â”‚  â””â”€ Port 5173
â””â”€ (Optional) database (PostgreSQL)
   â””â”€ Port 5432
```

### í”„ë¡œë•ì…˜ í™˜ê²½ (í–¥í›„)
```
Docker
â”œâ”€ backend + frontend (ì •ì  íŒŒì¼ ì„œë¹™)
â”‚  â””â”€ Port 80
â””â”€ (Optional) database
```

---

## í•µì‹¬ ê²°ì • ì‚¬í•­

### 1. ëª¨ë†€ë¦¬ì‹ vs ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤
**ê²°ì •**: ëª¨ë†€ë¦¬ì‹

**ì´ìœ **:
- í”„ë¡œì íŠ¸ ë²”ìœ„ê°€ ìž‘ê³  ëª…í™•
- Context ê°„ í†µì‹  ë³µìž¡ë„ ë¶ˆí•„ìš”
- ê°œë°œ ë° ë°°í¬ ë‹¨ìˆœí™”
- í–¥í›„ Context ë‹¨ìœ„ë¡œ ë¶„ë¦¬ ê°€ëŠ¥

---

### 2. ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš© ì—¬ë¶€
**ê²°ì •**: ì„ íƒì  (Phase 1+2ì—ì„œëŠ” ì¸ë©”ëª¨ë¦¬, í–¥í›„ PostgreSQL)

**ì´ìœ **:
- í˜„ìž¬ëŠ” ì €ìž¥ ê¸°ëŠ¥ ì—†ìŒ (ì œì™¸ ì‚¬í•­)
- ë Œë”ë§ ê²°ê³¼ë¥¼ ìž„ì‹œ ì €ìž¥ë§Œ í•„ìš”
- ì¸ë©”ëª¨ë¦¬ Mapìœ¼ë¡œ ì¶©ë¶„
- í–¥í›„ í™•ìž¥ ì‹œ TypeORM + PostgreSQL ì¶”ê°€

---

### 3. ì´ë²¤íŠ¸ ê¸°ë°˜ vs ì§ì ‘ í˜¸ì¶œ
**ê²°ì •**: í˜¼í•© (Layer ê°„ì€ ì§ì ‘ í˜¸ì¶œ, Context ê°„ì€ ì´ë²¤íŠ¸)

**ì´ìœ **:
- Layer ê°„: ë™ê¸° í˜¸ì¶œì´ ê°„ë‹¨í•˜ê³  ëª…í™•
- Context ê°„: ëŠìŠ¨í•œ ê²°í•© ìœ ì§€ (ì´ë²¤íŠ¸)
- í˜„ìž¬ Context ê°„ í†µì‹ ì´ ë‹¨ìˆœí•˜ì—¬ ì´ë²¤íŠ¸ ë¶ˆí•„ìš”
- í–¥í›„ í™•ìž¥ ëŒ€ë¹„ ì´ë²¤íŠ¸ êµ¬ì¡°ë§Œ ì •ì˜

---

### 4. í”„ë¡ íŠ¸ì—”ë“œ ì„œë²„ ë¶„ë¦¬
**ê²°ì •**: ê°œë°œ ì‹œ ë¶„ë¦¬, í”„ë¡œë•ì…˜ì—ì„œ í†µí•©

**ì´ìœ **:
- ê°œë°œ: Vite/Webpack Dev Server ì‚¬ìš© (Hot Reload)
- í”„ë¡œë•ì…˜: NestJSê°€ ì •ì  íŒŒì¼ ì„œë¹™
- ë‹¨ì¼ Docker ì´ë¯¸ì§€ë¡œ ë°°í¬ ê°„ì†Œí™”

---

## í™•ìž¥ ì „ëžµ (Phase 3)

### MCP ì„œë²„ ì¶”ê°€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MCP Client     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ MCP Protocol
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MCP Server     â”‚â”€â”€â”€â”€â”€â”€â”€â”‚ Mermaid Saiko   â”‚
â”‚  (ìƒˆ Layer)     â”‚       â”‚  Backend        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- MCP Server Layer ì¶”ê°€
- Application Layer ìž¬ì‚¬ìš©
- API Layerì™€ ë³‘ë ¬ êµ¬ì„±

---

## ìŠ¹ì¸ ìƒíƒœ

**ì „ì²´ ìŠ¹ì¸ ìƒíƒœ**: âœ… (ìŠ¹ì¸ ì™„ë£Œ - 2025-10-26)

**ìŠ¹ì¸ ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [x] ì „ì²´ ì‹œìŠ¤í…œ êµ¬ì¡° ìŠ¹ì¸
- [x] ë ˆì´ì–´ êµ¬ì¡° ìŠ¹ì¸
- [x] í•µì‹¬ ê²°ì • ì‚¬í•­ ìŠ¹ì¸
- [x] ë°°í¬ êµ¬ì¡° ìŠ¹ì¸

---

> ðŸ“Ž **ê´€ë ¨ ë¬¸ì„œ**:
> - `documents/domain-modeling/bounded-contexts.md`
> - `documents/api/rendering-api.md`
> - `documents/architecture/technology-stack.md`
